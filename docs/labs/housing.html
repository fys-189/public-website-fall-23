<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.251">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Housing Justice</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


<link rel="stylesheet" href="../css/custom.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">FYS 189: Data and Social Justice</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html">Syllabus</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../grading_contract.html">Grading Contract</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../schedule.html">Schedule</a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#overview" id="toc-overview" class="nav-link active" data-scroll-target="#overview">Overview</a></li>
  <li><a href="#the-counter-claim" id="toc-the-counter-claim" class="nav-link" data-scroll-target="#the-counter-claim">The Counter-Claim</a></li>
  <li><a href="#the-dataset" id="toc-the-dataset" class="nav-link" data-scroll-target="#the-dataset">The Dataset</a></li>
  <li><a href="#instructions" id="toc-instructions" class="nav-link" data-scroll-target="#instructions">Instructions</a>
  <ul class="collapse">
  <li><a href="#part-1-whats-in-this-dataset" id="toc-part-1-whats-in-this-dataset" class="nav-link" data-scroll-target="#part-1-whats-in-this-dataset">Part 1: What’s in this dataset?</a></li>
  <li><a href="#part-2-explore-the-mapping-inequality-website" id="toc-part-2-explore-the-mapping-inequality-website" class="nav-link" data-scroll-target="#part-2-explore-the-mapping-inequality-website">Part 2: Explore the Mapping Inequality website</a></li>
  <li><a href="#part-3-download-the-datasets" id="toc-part-3-download-the-datasets" class="nav-link" data-scroll-target="#part-3-download-the-datasets">Part 3: Download the datasets</a></li>
  <li><a href="#part-3-analyzing-the-data" id="toc-part-3-analyzing-the-data" class="nav-link" data-scroll-target="#part-3-analyzing-the-data">Part 3: Analyzing the data</a></li>
  <li><a href="#part-5-reflection" id="toc-part-5-reflection" class="nav-link" data-scroll-target="#part-5-reflection">Part 5: Reflection</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Housing Justice</h1>
<p class="subtitle lead">Responding to claims centered around meritocracy</p>
</div>



<div class="quarto-title-meta">

    
    
  </div>
  

</header>

<section id="overview" class="level2">
<h2 class="anchored" data-anchor-id="overview">Overview</h2>
<p>In this lab, you will work through a series of exercises to visualize data regarding lending practices in Chicago, IL. Through today’s exercises, you will be introduced to polygon mapping in Tableau, along with strategies for creatively filtering data.</p>
</section>
<section id="the-counter-claim" class="level2">
<h2 class="anchored" data-anchor-id="the-counter-claim">The Counter-Claim</h2>
<p>As you read this week, banking organizations across the U.S. have countered claims that high loan denial rates amongst certain sub-populations can serve as evidence of discriminatory lending practices. They note that just looking at denial rates across race and ethnicity fails to take into consideration the reasons for denial - low incomes, high debt, poor credit histories. They argue that it is not bias to reject a loan for these reasons, even if it means rejecting individuals in certain racial and ethnic groups more than others. Their arguments focus on the merit of certain of loan applicants. Doing so ignores the histories of structural segregation that create impact who has access to wealth and credit.</p>
<p>Refuting counter-claims based in meritocracy requires that we produce evidence of the legacies of structural inequity that shape people’s current access to resources and opportunities. Overall, this lab will demonstrate what we can see when we look beyond in-the-moment decision-making. It will also show how meritocracy arguments can fail when we zoom in on certain data points.</p>
</section>
<section id="the-dataset" class="level2">
<h2 class="anchored" data-anchor-id="the-dataset">The Dataset</h2>
<iframe width="560" height="315" src="https://www.youtube.com/embed/wR9Tsdqgmuk?si=7o-AaoVjdWWQUjZu" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen="">
</iframe>
<p>In order to ensure that financial institutions are in compliance with fair lending laws in the U.S. (such as the Equal Credit Opportunity Act and the Fair Housing Act), lenders are required to collect and report data on an applicant’s ethnicity, race, gender, and income when they apply for a mortgage. With the passing of the Home Mortgage Disclosure Act (HMDA) in 1975, financial institutions were at first required to report demographic information about applicants, aggregated by census tracts. The reporting of this data was largely prompted by concerns that banks were contributing to the decline of certain urban neighborhoods by denying qualified borrowers loans, as well as concerns that financial institutions were engaging in discriminatory lending practices and contributing to the redlining of neighborhoods. Growing concerns about individual-level discrimination in lending prompted the passing of the Financial Institutions Reform, Recovery, and Enforcement Act (FIRREA) of 1989, which required institutions to report demographic data (or what they call “government monitoring information”) for every applicant regardless of whether the loan was approved or denied.</p>
<p>Today, we’re going to analyze 2018 HMDA representing Cook County, Illinois. We’re also going to work a bit with historic redlining maps of Chicago, published by the University of Richmond’s Digital Scholarship Lab.</p>
<p>Robert K. Nelson, LaDale Winling, Richard Marciano, Nathan Connolly, et al., “Mapping Inequality,” American Panorama, ed.&nbsp;Robert K. Nelson and Edward L. Ayers, accessed September 3, 2023, <a href="https://dsl.richmond.edu/panorama/redlining/">https://dsl.richmond.edu/panorama/redlining/</a></p>
</section>
<section id="instructions" class="level2">
<h2 class="anchored" data-anchor-id="instructions">Instructions</h2>
<section id="part-1-whats-in-this-dataset" class="level3">
<h3 class="anchored" data-anchor-id="part-1-whats-in-this-dataset">Part 1: What’s in this dataset?</h3>
<p>Note that every row in the HMDA dataset is one loan application. Navigate the data documentation <a href="https://ffiec.cfpb.gov/documentation/publications/loan-level-datasets/lar-data-fields#action_taken">here</a> in order to see what gets reported in this dataset. Jot down terms that you are unfamiliar with. We will discuss them as a class.</p>
</section>
<section id="part-2-explore-the-mapping-inequality-website" class="level3">
<h3 class="anchored" data-anchor-id="part-2-explore-the-mapping-inequality-website">Part 2: Explore the Mapping Inequality website</h3>
<p>Explore historic redlining maps of Chicago (published by the University of Richmond’s Digital Scholarship Lab) by navigating <a href="https://dsl.richmond.edu/panorama/redlining/#loc=10/41.864/-87.915&amp;city=chicago-il&amp;area=D33">here</a>. Click on different neighborhoods on the map. What do the different colors on the map mean? What were some of the reasons different neighborhoods received different ratings?</p>
</section>
<section id="part-3-download-the-datasets" class="level3">
<h3 class="anchored" data-anchor-id="part-3-download-the-datasets">Part 3: Download the datasets</h3>
<p>Today, both of the datasets that we are going to be working contain polygon geometry. What do I mean by this? Check out the map below.</p>
<p>
<a href="https://commons.wikimedia.org/wiki/File:2022_United_States_gubernatorial_elections_term_limits_or_retirements_map.svg#/media/File:2022_United_States_gubernatorial_elections_term_limits_or_retirements_map.svg"><img src="https://upload.wikimedia.org/wikipedia/commons/5/52/2022_United_States_gubernatorial_elections_term_limits_or_retirements_map.svg" alt="2022 U.S. Gubernatorial Elections" height="396" width="640"></a><a href="https://creativecommons.org/licenses/by-sa/4.0" title="Creative Commons Attribution-Share Alike 4.0">CC BY-SA 4.0</a>, <a href="https://commons.wikimedia.org/w/index.php?curid=95159907">Link</a>
</p>
<p>Notice how every state is a polygon? Similarly, the datasets we will be using today are designed to allow us to map polygons of different neighborhoods and census tracts in Chicago.</p>
<ul>
<li>Download Chicago’s Historic Redlining Maps by clicking <a href="https://dsl.richmond.edu/panorama/redlining/static/downloads/shapefiles/ILChicago1940.zip">here</a>.</li>
<li>Download 2018 HMDA data from Cook County by clicking <a href="../data/hmda_chic_2018.geojson.zip">here</a></li>
</ul>
</section>
<section id="part-3-analyzing-the-data" class="level3">
<h3 class="anchored" data-anchor-id="part-3-analyzing-the-data">Part 3: Analyzing the data</h3>
<p>Open Tableau, and create a new workbook called <code>hmda_chicago</code>. Click “Connect to Data” and the <code>ILChicago1940.zip</code> file as a Spatial File. In the top menu, click Data &gt; New Data Source. Add <code>hmda_chic_2018.geojson</code> as a Spatial File.</p>
<p>Note that to save time, I’ve already cleaned this data for you. Specifically, I swapped out all of the numeric codes in the dataset with their qualitative labels. I’ve also added geometries of the census tracts associated with each row. However, there is one data type that we will need to fix before we open our first worksheet.</p>
<div class="question">
<p>In the Data Source tab, scroll to the column <code>Combined Loan to Value Ratio</code> and convert it to a Number (Decimal).</p>
</div>
<section id="question" class="level6">
<h6 class="anchored" data-anchor-id="question">Question</h6>
<div class="question">
<p>Create a worksheet in Tableau called “HOLC Maps of Chicago, IL - 1940”. Give the tab a descriptive name. Drag the <code>Geometry</code> pill onto the Tableau canvas. This will create a map of Chicago. Now drag the <code>HOLC Grade</code> to the Color field. Edit the map colors such that A is green, B is blue, C is yellow, and D is red. Finally, add the <code>HOLC ID</code> to the Detail field.</p>
<p>What do you notice about the geographies of segregation across the city?</p>
</div>
<section id="section" class="level7">
<p class="heading"></p>
<p>The map that you just created used a qualitative color palette, filling polygons according to the values in a categorical variable.</p>
<p>We can also color polygons according to a numeric variable by mapping the values in that variable to a shade of a color along a gradient. When we do so, we create what are called <em>chloropleth</em> maps.</p>
</section>
</section>
<section id="question-1" class="level6">
<h6 class="anchored" data-anchor-id="question-1">Question</h6>
<div class="question">
<p>Create a worksheet in Tableau called “Minority Population Percentage per Tract, Cook County, IL, 2018”. Give the tab a descriptive name. Drag the <code>Geometry</code> pill onto the Tableau canvas. This will create a map of Cook County. Drag the <code>Census Tract</code> pill to the Detail field in order to identify each census tract mapped. Now drag <code>Tract Minority Population Percentage</code> onto the Color field.</p>
<p>Note that each row in this dataset is a loan application, not a census tract. In 2018, there were many loan applications submitted in each tract. Because I’m mapping census tracts, by default, Tableau takes the sum of <code>Tract Minority Population Percentage</code> across every loan application in each tract. This doesn’t make sense, right? …because the value for <code>Tract Minority Population Percentage</code> is specific to the tract not the loan. Every loan application in that tract is going to have the same value listed in <code>Tract Minority Population Percentage</code>. I don’t need to sum across all applications; I just want to show the value for that tract. To do that, I’m going to convert <code>SUM(Tract Minority Population Percentage)</code> to an attribute by clicking on its pill in the Color field. Rename the legend title to something descriptive.</p>
<p>What do you notice about the geographies of minority populations across the city?</p>
</div>
</section>
<section id="question-2" class="level6">
<h6 class="anchored" data-anchor-id="question-2">Question</h6>
<div class="question">
<p>Create a worksheet in Tableau called “MSA Income Percentage per Tract, Cook County, IL, 2018”. Give the tab a descriptive name. Repeat the steps above but using the <code>Tract to Msa Income Percentage</code> pill.</p>
<p>What do you notice about the geographies of income inequality across the city?</p>
</div>
</section>
<section id="question-3" class="level6">
<h6 class="anchored" data-anchor-id="question-3">Question</h6>
<div class="question">
<p>Create a worksheet in Tableau called “Amounts of Loans Originated per Tract, Cook County, IL, 2018”. Give the tab a descriptive name. Repeat the steps above but using the <code>Loan Amount</code> pill. This time, leave the aggregation as a SUM, since we want a total of the loans originated in each census tract. Finally, drag the <code>Action Taken</code> pill to the filter panel, and filter the plot to only include loans that were originated.</p>
<p>What do you notice about the geographies of loan resources originated across the city?</p>
</div>
<section id="section-1" class="level7">
<p class="heading"></p>
<p>When we dragged <code>Action Taken</code> to the filters panel, we created a <em>global filter</em> on the data. This means that we filtered the original Data Source such that only originated loans would be considered in our analysis/visualizations. Recall that this is different from creating a <em>local filter</em> on data. When applying local filters, the data remains the same in the original Data Source, but we hide certain variables from view in our visualizations.</p>
</section>
</section>
<section id="question-4" class="level6">
<h6 class="anchored" data-anchor-id="question-4">Question</h6>
<div class="question">
<p>Create a worksheet in Tableau called “Loan Application Denial Percentage per Tract, Cook County, IL, 2018”. Give the tab a descriptive name. Drag the <code>Geometry</code> pill onto the Tableau canvas. This will create a map of Cook County. Drag the <code>Census Tract</code> pill to the Detail field in order to identify each census tract mapped. Now drag <code>hmda_chic_2018.geojson (Count)</code> onto the Color field. This creates a map indicating how many loan applications were submitted in each census tract in Cook County, IL.</p>
<p>We are specifically interested in where applications were denied. Drag the <code>Action Taken</code> pill onto the Rows field. Note how this creates 8 rows of maps - one for each action listed in that variable. Right click on each Action listed on the Tableau canvas except for “Application denied” and click “Hide”. Note that this is a local filter, not a global filter. It filters the data on our screen, but not the data source.</p>
<p>Right now we have a map that shows us the total number of applications denied in each tract. …but we can’t tell if a tract having numerous denials is a result of a high denial rate or just more applications being submitted in the tract. What if we would like to see denials as a percentage of the all the applications submitted in each tract? Click on the <code>hmda_chic_2018.geojson (Count)</code> pill you mapped onto the Color field, and add a Quick Table Calculation &gt; Percent of Total. We’re trying to see the percentage of denials out of all possible actions taken, so you’ll want to click on the pill again and select “Compute Using…” &gt; Action Taken.</p>
<p>What do you notice about the geographies of denial rates across the city?</p>
</div>
<section id="section-2" class="level7">
<p class="heading"></p>
<p>Taken together, what story can you tell about legacies of segregation in Chicago? What additional data would you need to fill in gaps in those stories?</p>
<p>These maps provide us with information about lending practices on a census tract level, but what if I wanted to examine potential discriminatory lending practices on an individual level?</p>
</section>
</section>
<section id="question-5" class="level6">
<h6 class="anchored" data-anchor-id="question-5">Question</h6>
<div class="question">
<p>Create a worksheet in Tableau called “Loan Application Actions by Race, Cook County, IL, 2018”. Give the tab a descriptive name. Drag the <code>Action Taken</code> field onto the Rows field, followed by the <code>Derived Race</code> field. Drag the <code>hmda_chic_2018.geojson (Count)</code> field onto the Columns field. Convert the count to a percentage of total, such that the percentage we see is a percentage of a specific action out of all possible actions (i.e.&nbsp;denial rate, origination rate, etc. )</p>
<p>What do you notice about the differences in denial rates and origination rates across racial groups?</p>
</div>
</section>
<section id="question-6" class="level6">
<h6 class="anchored" data-anchor-id="question-6">Question</h6>
<div class="question">
<p>Create a worksheet in Tableau called “Loan Application Actions by Ethnicity, Cook County, IL, 2018”. Give the tab a descriptive name. Repeat the steps above, but for <code>Derived Ethnicity</code>.</p>
<p>What do you notice about the differences in denial rates and origination rates across ethnic groups?</p>
</div>
<section id="section-3" class="level7">
<p class="heading"></p>
<p>We know income and debt to be unequally distributed along racial and ethnic lines due to histories of structural inequality. The redlining maps we recreated at the start of this lab are just one form of structural inequality that reshaped racial wealth in the 1900s. …but for a moment, for rhetorical purposes, let’s set this knowledge aside. Assuming that loan originators are just trying to play by the rules, we could assume that two individuals - one white and one black - with similar incomes, and similar debt would see similar outcomes when applying for a similar loan in the same year. Let’s test that out in our data.</p>
</section>
</section>
<section id="question-7" class="level6">
<h6 class="anchored" data-anchor-id="question-7">Question</h6>
<div class="question">
<p>On the worksheet called “Loan Application Actions by Ethnicity, Cook County, IL, 2018”, add filters for <code>Income</code>, <code>Debt to Income Ratio</code>, <code>Combined Loan to Value Ratio</code>. Click on each of these filters in the Filters Panel, and select “Show Filter” in order to show an interactive filter on the worksheet. Finally, drag <code>Denial Reason 1</code> to the Tooltip field.</p>
<p>Filter the data such that applications with similar loan to value ratios from individuals with similar incomes and similar debt-to-income ratios appear in the plot.</p>
<p>What changes in regards to denial rates across ethnic groups do you notice?</p>
<p>As you filter, click on the bars in the graph to view the underlying full data.</p>
<p><img src="img/view_data.png" class="img-fluid"></p>
<p><img src="img/full_data.png" class="img-fluid"></p>
<p>How did the denial reasons differ across racial and ethnic groups?</p>
<p>Click on each of your interactive filters and select Apply to Worksheets &gt; Selected Worksheets. Add each filter to “Loan Application Actions by Race, Cook County, IL, 2018”. Experiment with the filters on this second worksheet and review the underlying data.</p>
<p>What changes in regards to denial rates across racial groups do you notice?</p>
</div>
</section>
</section>
<section id="part-5-reflection" class="level3">
<h3 class="anchored" data-anchor-id="part-5-reflection">Part 5: Reflection</h3>
<p>Note that this data does not include the credit scores of applicants, so we can’t assess the role of credit history in decision-making. How might we summarize what we just learned into a factual claim? For one, we can see that historically red-lined neighborhoods in Chicago continue to be segregated and continue to have higher loan denial rates. We can also see that financial resources tend to be concentrated in areas of the city that have historically been prioritized for mortgage lending. Further, we can see that, even when factoring in income, debt, and loan amounts, denial rates are unevenly distributed across racial and ethnic groups in Chicago. Can we go so far as to claim that this data provides evidence of discriminatory lending? If not, what further data would we need to assess this? …and how should we respond to arguments from the lending industry that this data cannot show discrimination?</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>